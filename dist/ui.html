<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Design Token Export</title></head><body><h2>Design Token Export</h2><p>Extract your Figma design variables as DTCG-compliant design tokens.</p><div id="content"><div class="option-group"><h3>Format Options</h3><div class="radio-item"><input type="radio" id="format-dtcg" name="format" value="dtcg" checked="checked"> <label for="format-dtcg">DTCG Format (Design Tokens Community Group)</label></div><div class="radio-item"><input type="radio" id="format-legacy" name="format" value="legacy"> <label for="format-legacy">Legacy Format (Simple JSON)</label></div><h3>Color Format</h3><div class="radio-item"><input type="radio" id="color-hex" name="color-format" value="hex" checked="checked"> <label for="color-hex">HEX (#ffffff)</label></div><div class="radio-item"><input type="radio" id="color-rgb" name="color-format" value="rgb"> <label for="color-rgb">RGB (rgb(255, 255, 255))</label></div><div class="radio-item"><input type="radio" id="color-rgba" name="color-format" value="rgba"> <label for="color-rgba">RGBA (rgba(255, 255, 255, 1))</label></div><div class="radio-item"><input type="radio" id="color-hsl" name="color-format" value="hsl"> <label for="color-hsl">HSL (hsl(0deg, 0%, 100%))</label></div><div class="radio-item"><input type="radio" id="color-hsla" name="color-format" value="hsla"> <label for="color-hsla">HSLA (hsla(0deg, 0%, 100%, 1))</label></div><h3>Export Options</h3><div class="checkbox-item"><input type="checkbox" id="separate-files" checked="checked"> <label for="separate-files">Export separate files (one per collection/mode)</label></div><div class="checkbox-item"><input type="checkbox" id="validate-references" checked="checked"> <label for="validate-references">Validate and fix references</label></div><div class="checkbox-item"><input type="checkbox" id="flat-structure"> <label for="flat-structure">Generate flat structure (easier reference resolution)</label></div><div class="checkbox-item"><input type="checkbox" id="preview-tokens"> <label for="preview-tokens">Show visual token preview</label></div></div><div class="selection-group"><h3>Collections & Modes <span class="select-all" id="toggle-all-collections">Select All</span></h3><div id="collection-modes-list"><div class="loading"><div class="spinner"></div>Loading collections and modes...</div></div></div><div id="reference-validation-results" class="reference-validation" style="display: none;"><h3>Reference Validation</h3><div id="validation-content">Validating references...</div></div><div id="preview-container"><h3>Preview</h3><div class="preview-tabs" id="preview-tabs"><button class="tab-button active" data-tab="combined">Combined</button></div><div class="preview-content"><div class="tab-content" id="tab-combined" style="display: block;"><pre id="output">Loading data...</pre></div></div></div><div><button id="extract-btn">Refresh Tokens</button> <button id="download-btn" disabled="disabled">Download JSON</button> <button id="validate-btn">Validate References</button></div></div><div id="status" class="info">Waiting for data...</div><script>(()=>{"use strict";var e={56:(e,n,t)=>{e.exports=function(e){var n=t.nc;n&&e.setAttribute("nonce",n)}},72:e=>{var n=[];function t(e){for(var t=-1,o=0;o<n.length;o++)if(n[o].identifier===e){t=o;break}return t}function o(e,o){for(var a={},c=[],i=0;i<e.length;i++){var l=e[i],s=o.base?l[0]+o.base:l[0],d=a[s]||0,p="".concat(s," ").concat(d);a[s]=d+1;var u=t(p),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)n[u].references++,n[u].updater(f);else{var m=r(f,o);o.byIndex=i,n.splice(i,0,{identifier:p,updater:m,references:1})}c.push(p)}return c}function r(e,n){var t=n.domAPI(n);return t.update(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap&&n.supports===e.supports&&n.layer===e.layer)return;t.update(e=n)}else t.remove()}}e.exports=function(e,r){var a=o(e=e||[],r=r||{});return function(e){e=e||[];for(var c=0;c<a.length;c++){var i=t(a[c]);n[i].references--}for(var l=o(e,r),s=0;s<a.length;s++){var d=t(a[s]);0===n[d].references&&(n[d].updater(),n.splice(d,1))}a=l}}},113:e=>{e.exports=function(e,n){if(n.styleSheet)n.styleSheet.cssText=e;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var n=[];return n.toString=function(){return this.map((function(n){var t="",o=void 0!==n[5];return n[4]&&(t+="@supports (".concat(n[4],") {")),n[2]&&(t+="@media ".concat(n[2]," {")),o&&(t+="@layer".concat(n[5].length>0?" ".concat(n[5]):""," {")),t+=e(n),o&&(t+="}"),n[2]&&(t+="}"),n[4]&&(t+="}"),t})).join("")},n.i=function(e,t,o,r,a){"string"==typeof e&&(e=[[null,e,void 0]]);var c={};if(o)for(var i=0;i<this.length;i++){var l=this[i][0];null!=l&&(c[l]=!0)}for(var s=0;s<e.length;s++){var d=[].concat(e[s]);o&&c[d[0]]||(void 0!==a&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=a),t&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=t):d[2]=t),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),n.push(d))}},n}},394:(e,n,t)=>{t.d(n,{A:()=>i});var o=t(601),r=t.n(o),a=t(314),c=t.n(a)()(r());c.push([e.id,'/* Tab styling fixes */\n\n.preview-tabs {\n    display: flex;\n    flex-wrap: wrap;\n    border-bottom: 1px solid #ddd;\n    margin-bottom: 10px;\n    gap: 4px;\n  }\n  \n  .tab-button {\n    padding: 6px 12px;\n    background-color: #f0f0f0;\n    border: 1px solid #ddd;\n    border-bottom: none;\n    border-radius: 4px 4px 0 0;\n    cursor: pointer;\n    font-size: 11px;\n    font-weight: 500;\n    color: #555;\n    position: relative;\n    bottom: -1px;\n    margin-bottom: 0;\n  }\n  \n  .tab-button:hover {\n    background-color: #e5e5e5;\n  }\n  \n  .tab-button.active {\n    background-color: white;\n    border-bottom: 1px solid white;\n    color: #18a0fb;\n    z-index: 1;\n  }\n  \n  .preview-content {\n    position: relative;\n    border: 1px solid #ddd;\n    border-top: none;\n    padding: 10px;\n    border-radius: 0 0 4px 4px;\n    background-color: white;\n  }\n  \n  .tab-content {\n    display: none; /* Hide all tab content by default */\n  }\n  \n  /* Make sure the active tab content is visible */\n  .tab-content.active,\n  .tab-content[style*="display: block"] {\n    display: block !important;\n  }\n  \n  /* Fix any overflow issues */\n  .preview-content pre {\n    margin: 0;\n    white-space: pre-wrap;\n    word-break: break-word;\n    overflow-x: auto;\n  }',""]);const i=c},513:(e,n,t)=>{t.d(n,{A:()=>i});var o=t(601),r=t.n(o),a=t(314),c=t.n(a)()(r());c.push([e.id,"/* Color preview styles */\n\n.color-preview-container {\n    margin-top: 16px;\n    border: 1px solid #e5e5e5;\n    border-radius: 4px;\n    overflow: hidden;\n  }\n  \n  .color-preview-item {\n    display: flex;\n    align-items: center;\n    padding: 8px 12px;\n    border-bottom: 1px solid #f0f0f0;\n  }\n  \n  .color-preview-item:last-child {\n    border-bottom: none;\n  }\n  \n  .color-swatch {\n    width: 24px;\n    height: 24px;\n    border-radius: 4px;\n    margin-right: 12px;\n    border: 1px solid rgba(0, 0, 0, 0.1);\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n  }\n  \n  .color-info {\n    flex: 1;\n  }\n  \n  .color-path {\n    font-weight: 500;\n    font-size: 11px;\n    margin-bottom: 2px;\n  }\n  \n  .color-value {\n    font-family: monospace;\n    font-size: 10px;\n    color: #666;\n  }\n  \n  .color-preview-heading {\n    background-color: #f9f9f9;\n    padding: 8px 12px;\n    font-weight: 500;\n    font-size: 12px;\n    border-bottom: 1px solid #e5e5e5;\n  }\n  \n  .color-format-controls {\n    margin-top: 8px;\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n  }\n  \n  .color-format-button {\n    font-size: 11px;\n    padding: 4px 8px;\n    background: #f0f0f0;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    cursor: pointer;\n  }\n  \n  .color-format-button:hover {\n    background: #e5e5e5;\n  }\n  \n  .color-format-button.active {\n    background: #0366d6;\n    color: white;\n    border-color: #0366d6;\n  }\n  \n  /* Checkerboard background for transparent colors */\n  .color-swatch.transparent {\n    background-image: \n      linear-gradient(45deg, #eee 25%, transparent 25%),\n      linear-gradient(-45deg, #eee 25%, transparent 25%),\n      linear-gradient(45deg, transparent 75%, #eee 75%),\n      linear-gradient(-45deg, transparent 75%, #eee 75%);\n    background-size: 10px 10px;\n    background-position: 0 0, 0 5px, 5px -5px, -5px 0px;\n  }\n  \n  /* Color preview panel in token view */\n  .color-preview-panel {\n    position: absolute;\n    z-index: 10;\n    background: white;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n    padding: 12px;\n    min-width: 200px;\n    font-size: 12px;\n  }\n  \n  .preview-color-swatch {\n    width: 100%;\n    height: 40px;\n    border-radius: 4px;\n    margin-bottom: 8px;\n    border: 1px solid rgba(0, 0, 0, 0.1);\n  }\n  \n  .color-format-list {\n    margin-top: 8px;\n  }\n  \n  .color-format-item {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 4px;\n    font-size: 11px;\n  }\n  \n  .color-format-label {\n    font-weight: 500;\n    margin-right: 8px;\n  }\n  \n  .color-format-value {\n    font-family: monospace;\n    color: #666;\n  }\n  \n  .copy-button {\n    font-size: 11px;\n    padding: 2px 6px;\n    background: #f5f5f5;\n    border: 1px solid #ddd;\n    border-radius: 4px;\n    cursor: pointer;\n    margin-left: 4px;\n  }\n  \n  .copy-button:hover {\n    background: #e5e5e5;\n  }\n  \n  .color-preview-close {\n    position: absolute;\n    top: 8px;\n    right: 8px;\n    cursor: pointer;\n    font-size: 14px;\n    color: #999;\n  }\n  \n  .color-preview-close:hover {\n    color: #666;\n  }",""]);const i=c},540:e=>{e.exports=function(e){var n=document.createElement("style");return e.setAttributes(n,e.attributes),e.insert(n,e.options),n}},601:e=>{e.exports=function(e){return e[1]}},628:(e,n,t)=>{t.d(n,{A:()=>i});var o=t(601),r=t.n(o),a=t(314),c=t.n(a)()(r());c.push([e.id,"body {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\n    margin: 0;\n    padding: 20px;\n    font-size: 12px;\n    color: #333;\n  }\n  \n  h2 {\n    margin-bottom: 16px;\n    font-size: 16px;\n    font-weight: 600;\n  }\n  \n  h3 {\n    margin-top: 16px;\n    margin-bottom: 8px;\n    font-size: 14px;\n    font-weight: 500;\n  }\n  \n  p {\n    margin-bottom: 16px;\n    color: #666;\n  }\n  \n  button {\n    background-color: #18a0fb;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    padding: 8px 16px;\n    margin-right: 8px;\n    margin-top: 16px;\n    cursor: pointer;\n    font-weight: 500;\n  }\n  \n  button:hover {\n    background-color: #0d8ce0;\n  }\n  \n  button:disabled {\n    background-color: #cccccc;\n    cursor: not-allowed;\n  }\n  \n  .selection-group {\n    margin-top: 16px;\n    margin-bottom: 16px;\n    padding: 12px;\n    border: 1px solid #e5e5e5;\n    border-radius: 4px;\n    background-color: #f9f9f9;\n  }\n  \n  .option-group {\n    margin-top: 16px;\n    margin-bottom: 16px;\n    padding: 12px;\n    border: 1px solid #e5e5e5;\n    border-radius: 4px;\n    background-color: #f0f7ff;\n  }\n  \n  .checkbox-item {\n    display: flex;\n    align-items: center;\n    margin-bottom: 8px;\n  }\n  \n  .checkbox-item label {\n    margin-left: 8px;\n    cursor: pointer;\n  }\n  \n  .radio-item {\n    display: flex;\n    align-items: center;\n    margin-bottom: 8px;\n  }\n  \n  .radio-item label {\n    margin-left: 8px;\n    cursor: pointer;\n  }\n  \n  .mode-container {\n    margin-left: 24px;\n    padding-top: 4px;\n  }\n  \n  pre {\n    background-color: #f5f5f5;\n    padding: 10px;\n    border-radius: 4px;\n    overflow: auto;\n    max-height: 300px;\n    font-family: monospace;\n    font-size: 11px;\n  }\n  \n  .reference-validation {\n    background-color: #fff8e1;\n    padding: 10px;\n    border-radius: 4px;\n    border-left: 4px solid #ffca28;\n    margin-top: 16px;\n    font-size: 11px;\n  }\n  \n  .reference-problem {\n    color: #d32f2f;\n    font-weight: 500;\n    padding: 4px 0;\n  }\n  \n  #status {\n    margin-top: 16px;\n    padding: 8px 12px;\n    border-radius: 4px;\n    font-size: 12px;\n  }\n  \n  .info {\n    background-color: #e8f4fd;\n    color: #0366d6;\n  }\n  \n  .success {\n    background-color: #e6ffed;\n    color: #22863a;\n  }\n  \n  .warning {\n    background-color: #fff8e1;\n    color: #b08800;\n  }\n  \n  .error {\n    background-color: #ffeef0;\n    color: #d73a49;\n  }\n  \n  .loading {\n    display: flex;\n    align-items: center;\n    font-style: italic;\n    color: #666;\n  }\n  \n  .spinner {\n    display: inline-block;\n    width: 12px;\n    height: 12px;\n    margin-right: 8px;\n    border: 2px solid #f3f3f3;\n    border-top: 2px solid #3498db;\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n  }\n  \n  @keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n  \n  .select-all {\n    font-size: 11px;\n    color: #0366d6;\n    cursor: pointer;\n    margin-left: 16px;\n  }\n  \n  .validation-tools {\n    margin-top: 16px;\n    padding-top: 8px;\n    border-top: 1px solid #e5e5e5;\n  }\n  \n  .pill {\n    display: inline-block;\n    padding: 2px 8px;\n    margin-right: 4px;\n    border-radius: 12px;\n    font-size: 10px;\n    font-weight: 500;\n    background-color: #e1f5fe;\n    color: #0277bd;\n  }\n  \n  .export-options {\n    margin-top: 16px;\n    display: flex;\n    gap: 8px;\n  }\n  \n  .dropdown-select {\n    padding: 6px 8px;\n    border-radius: 4px;\n    border: 1px solid #ccc;\n    background-color: white;\n    font-size: 12px;\n  }",""]);const i=c},659:e=>{var n={};e.exports=function(e,t){var o=function(e){if(void 0===n[e]){var t=document.querySelector(e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}n[e]=t}return n[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var n=e.insertStyleElement(e);return{update:function(t){!function(e,n,t){var o="";t.supports&&(o+="@supports (".concat(t.supports,") {")),t.media&&(o+="@media ".concat(t.media," {"));var r=void 0!==t.layer;r&&(o+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),o+=t.css,r&&(o+="}"),t.media&&(o+="}"),t.supports&&(o+="}");var a=t.sourceMap;a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),n.styleTagTransform(o,e,n.options)}(n,e,t)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)}}}}},n={};function t(o){var r=n[o];if(void 0!==r)return r.exports;var a=n[o]={id:o,exports:{}};return e[o](a,a.exports,t),a.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.nc=void 0;var o=t(72),r=t.n(o),a=t(825),c=t.n(a),i=t(659),l=t.n(i),s=t(56),d=t.n(s),p=t(540),u=t.n(p),f=t(113),m=t.n(f),g=t(628),b={};b.styleTagTransform=m(),b.setAttributes=d(),b.insert=l().bind(null,"head"),b.domAPI=c(),b.insertStyleElement=u(),r()(g.A,b),g.A&&g.A.locals&&g.A.locals;var h=t(513),v={};v.styleTagTransform=m(),v.setAttributes=d(),v.insert=l().bind(null,"head"),v.domAPI=c(),v.insertStyleElement=u(),r()(h.A,v),h.A&&h.A.locals&&h.A.locals;var x=t(394),y={};function k(e){return JSON.stringify(e,null,2)}function $(e,n,t,o){if(!e||0===n.length||0===t.length)return{};const r={};for(const o of n)if(e[o]){r[o]={};for(const n in e[o])t.includes(n)&&(r[o][n]=e[o][n]);0===Object.keys(r[o]).length&&delete r[o]}return o?function(e){const n={};function t(e,o,r,a){for(const c in a){const i=r?`${r}.${c}`:c,l=a[c];l&&"object"==typeof l&&"$value"in l?n[`${e}.${o}.${i}`]=Object.assign({},l):l&&"object"==typeof l&&!("$value"in l)?t(e,o,i,l):null!=l&&"object"!=typeof l&&(n[`${e}.${o}.${i}`]=l)}}for(const n in e)for(const o in e[n])t(n,o,"",e[n][o]);return n}(r):r}function w(e,n){const t=JSON.stringify(e,null,2),o=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(o),a=document.createElement("a");a.href=r,a.download=n,a.click(),URL.revokeObjectURL(r)}function E(e,n,t){console.log(`Setting active tab: ${e}`);const o=n.querySelectorAll(".tab-button"),r=t.querySelectorAll(".tab-content");o.forEach((e=>e.classList.remove("active"))),r.forEach((e=>{e.style.display="none"}));const a=n.querySelector(`.tab-button[data-tab="${e}"]`);a?a.classList.add("active"):console.error(`Tab button not found: ${e}`);const c=document.getElementById(`tab-${e}`);c?c.style.display="block":console.error(`Tab content not found: tab-${e}`)}function C(e,n){const t={};return function e(n,o){if(n&&"object"==typeof n)if(void 0===n.$value)for(const r in n){const a=o?`${o}.${r}`:r;"object"==typeof n[r]&&null!==n[r]?e(n[r],a):t[a]=n[r]}else t[o]=Object.assign({},n);else t[o]=n}(n,e),t}function S({r:e,g:n,b:t,a:o=1}){const r=Math.round(255*e),a=Math.round(255*n),c=Math.round(255*t);return void 0!==o&&o<1?`rgba(${r}, ${a}, ${c}, ${o.toFixed(2)})`:`rgb(${r}, ${a}, ${c})`}function L({r:e,g:n,b:t,a:o=1}){var r;const a=function({r:e,g:n,b:t,a:o=1}){const r=e,a=n,c=t,i=Math.max(r,a,c),l=Math.min(r,a,c),s=i-l;let d=0,p=0,u=(i+l)/2;if(0!==s)switch(p=u>.5?s/(2-i-l):s/(i+l),i){case r:d=60*((a-c)/s+(a<c?6:0));break;case a:d=60*((c-r)/s+2);break;case c:d=60*((r-a)/s+4)}return{h:d,s:100*p,l:100*u,a:o}}({r:e,g:n,b:t,a:o});return void 0!==o&&o<1?`hsla(${Math.round(a.h)}deg, ${Math.round(a.s)}%, ${Math.round(a.l)}%, ${null===(r=a.a)||void 0===r?void 0:r.toFixed(2)})`:`hsl(${Math.round(a.h)}deg, ${Math.round(a.s)}%, ${Math.round(a.l)}%)`}function M(e){3===(e=e.replace("#","")).length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);let n=1;8===e.length&&(n=parseInt(e.slice(6,8),16)/255,e=e.substring(0,6));const t=parseInt(e,16);return{r:(t>>16&255)/255,g:(t>>8&255)/255,b:(255&t)/255,a:n}}function A(e,n){const t=JSON.parse(JSON.stringify(e));function o(e){if(e&&"object"==typeof e&&void 0!==e.$value)return"color"===e.$type&&(e.$value=function(e,n){if("string"==typeof e){if(e.startsWith("#")){const t=M(e);switch(n){case"hex":return e;case"rgb":case"rgba":return S(t);case"hsl":case"hsla":return L(t)}}return e}if("object"==typeof e&&"r"in e&&"g"in e&&"b"in e)switch(n){case"hex":default:return function({r:e,g:n,b:t,a:o=1}){const r=Math.round(255*e).toString(16).padStart(2,"0"),a=Math.round(255*n).toString(16).padStart(2,"0"),c=Math.round(255*t).toString(16).padStart(2,"0");return void 0!==o&&o<1?`#${r}${a}${c}${Math.round(255*o).toString(16).padStart(2,"0")}`:`#${r}${a}${c}`}(e);case"rgb":case"rgba":return S(e);case"hsl":case"hsla":return L(e)}return e}(e.$value,n)),e;if(e&&"object"==typeof e&&!Array.isArray(e))for(const n in e)e[n]=o(e[n]);return e}for(const e in t)for(const n in t[e])t[e][n]=o(t[e][n]);return t}function N(e,n){try{if(e.startsWith("#")){const t=M(e);switch(n){case"hex":default:return e;case"rgb":case"rgba":return S(t);case"hsl":case"hsla":return L(t)}}else{if(e.startsWith("rgb"))return e;if(e.startsWith("hsl"))return e}return e}catch(n){return console.error("Error formatting color:",n),e}}y.styleTagTransform=m(),y.setAttributes=d(),y.insert=l().bind(null,"head"),y.domAPI=c(),y.insertStyleElement=u(),r()(x.A,y),x.A&&x.A.locals&&x.A.locals;let I=null,j=null,T=[],B=new Map,O=null,z=!0,q=[],R="hex",H=!1;const U=document.getElementById("output"),W=document.getElementById("status"),F=document.getElementById("download-btn"),D=document.getElementById("extract-btn"),J=document.getElementById("validate-btn"),P=document.getElementById("collection-modes-list"),V=document.getElementById("toggle-all-collections"),G=document.getElementById("validate-references"),X=document.getElementById("flat-structure"),Y=document.getElementById("separate-files"),_=document.getElementById("format-dtcg"),K=document.getElementById("format-legacy"),Q=document.getElementById("reference-validation-results"),Z=document.getElementById("validation-content"),ee=document.getElementById("preview-tabs"),ne=document.querySelector(".preview-content"),te=document.getElementById("preview-colors"),oe=document.getElementById("color-hex"),re=document.getElementById("color-rgb"),ae=document.getElementById("color-rgba"),ce=document.getElementById("color-hsl"),ie=document.getElementById("color-hsla");function le(){if(!I||!j)return;let e=JSON.parse(JSON.stringify(j));e=A(e,R),I=e;const n=[];B.forEach(((e,t)=>{e.forEach((e=>{n.push(e)}))}));const t=$(I,T,n,X.checked);if(U.textContent=k(t),function(e,n,t,o,r,a,c){var i;a.querySelectorAll('.tab-button:not([data-tab="combined"])').forEach((e=>e.remove())),c.querySelectorAll(".tab-content:not(#tab-combined)").forEach((e=>e.remove()));const l=function(e,n,t,o){const r=[];for(const a of n)if(e[a]){const n=t.get(a)||[];for(const t of n)if(e[a][t]){const n=o?C(`${a}.${t}`,e[a][t]):{[a]:{[t]:e[a][t]}};r.push({id:`${a}-${t}`,name:`${a}/${t}`,data:n})}}return r}(e,n,t,o);l.forEach((e=>{const n=document.createElement("button");n.className="tab-button",n.dataset.tab=e.id,n.textContent=e.name,n.addEventListener("click",(n=>{n.preventDefault(),E(e.id,a,c)})),a.appendChild(n);const t=document.createElement("div");t.className="tab-content",t.id=`tab-${e.id}`,t.style.display="none";const o=document.createElement("pre");o.textContent=k(e.data),t.appendChild(o),c.appendChild(t)}));const s=a.querySelector('.tab-button[data-tab="combined"]');if(s){const e=s.cloneNode(!0);null===(i=s.parentNode)||void 0===i||i.replaceChild(e,s),e.addEventListener("click",(e=>{e.preventDefault(),E("combined",a,c)}))}E("combined",a,c)}(I,T,B,X.checked,Y.checked,ee,ne),H)!function(e){var n;const t=function(e){const n=[];function t(e,o=""){if(e&&"object"==typeof e)if(void 0===e.$value||"color"!==e.$type)for(const r in e){const a=o?`${o}/${r}`:r,c=e[r];"object"==typeof c&&null!==c?t(c,a):"string"==typeof c&&(c.startsWith("#")||c.startsWith("rgb")||c.startsWith("hsl"))&&n.push({path:a,value:c,originalValue:c})}else n.push({path:o,value:e.$value,originalValue:e.$value})}for(const n in e)for(const o in e[n])t(e[n][o],`${n}/${o}`);return n}(e),o=document.querySelector(".color-preview-container");o&&o.remove();const r=function(e,n){if(0===e.length)return'<div class="color-preview-container"><div class="color-preview-heading">No color tokens found</div></div>';let t='<div class="color-preview-container">';t+='<div class="color-preview-heading">Color Tokens Preview</div>';const o={};e.forEach((e=>{const n=e.path.split("/");if(n.length>=2){const t=n[0];o[t]||(o[t]=[]),o[t].push(e)}}));for(const e in o)t+=`<div class="color-preview-heading">${e}</div>`,o[e].forEach((e=>{const o=e.value.includes("rgba")||e.value.includes("hsla")||e.value.startsWith("#")&&9===e.value.length,r=e.path.split("/").slice(2).join("/");t+=`\n          <div class="color-preview-item" data-color-path="${e.path}" data-color-value="${e.value}">\n            <div class="color-swatch ${o?"transparent":""}" style="background-color: ${e.value}"></div>\n            <div class="color-info">\n              <div class="color-path">${r}</div>\n              <div class="color-value">${N(e.value,n)}</div>\n            </div>\n          </div>\n        `}));return t+="</div>",t}(t,R),a=document.createElement("div");a.className="color-preview-wrapper",a.innerHTML=r,null===(n=ne.parentNode)||void 0===n||n.insertBefore(a,ne.nextSibling),function(e,n,t){e.addEventListener("click",(e=>{const o=e.target.closest(".color-preview-item");o&&function(e,o,r){var a;document.querySelectorAll(".color-preview-panel").forEach((e=>{e.remove()}));const c=document.createElement("div");c.className="color-preview-panel";const i=e.getBoundingClientRect();c.style.top=`${i.bottom+window.scrollY+5}px`,c.style.left=`${i.left+window.scrollX}px`;let l=`\n        <div class="preview-color-swatch" style="background-color: ${o}"></div>\n        <div class="color-path-full">${r}</div>\n        <div class="color-format-list">\n      `;const s=[{label:"HEX",format:"hex"},{label:"RGB",format:"rgb"},{label:"RGBA",format:"rgba"},{label:"HSL",format:"hsl"},{label:"HSLA",format:"hsla"}];s.forEach((({label:e,format:n})=>{const t=N(o,n);l+=`\n          <div class="color-format-item">\n            <span class="color-format-label">${e}:</span>\n            <span class="color-format-value">${t}</span>\n            <button class="copy-button" data-color-value="${t}">Copy</button>\n          </div>\n        `})),l+='\n        </div>\n        <div class="color-format-controls">\n          <div>Set as default format:</div>\n          <div class="format-buttons">\n      ',s.forEach((({label:e,format:t})=>{l+=`\n          <button class="color-format-button ${t===n?"active":""}" \n                  data-format="${t}">${e}</button>\n        `})),l+='\n          </div>\n        </div>\n        <div class="color-preview-close">×</div>\n      ',c.innerHTML=l,document.body.appendChild(c),c.querySelectorAll(".copy-button").forEach((e=>{e.addEventListener("click",(e=>{const n=e.currentTarget.dataset.colorValue||"";navigator.clipboard.writeText(n).then((()=>{e.currentTarget.textContent="Copied!",setTimeout((()=>{e.currentTarget.textContent="Copy"}),1e3)})).catch((e=>{console.error("Could not copy text: ",e)}))}))})),c.querySelectorAll(".color-format-button").forEach((e=>{e.addEventListener("click",(e=>{const n=e.currentTarget.dataset.format;t(n),c.querySelectorAll(".color-format-button").forEach((e=>{e.classList.remove("active")})),e.currentTarget.classList.add("active")}))})),null===(a=c.querySelector(".color-preview-close"))||void 0===a||a.addEventListener("click",(()=>{c.remove()})),document.addEventListener("click",(function n(t){c.contains(t.target)||e.contains(t.target)||(c.remove(),document.removeEventListener("click",n))}))}(o,o.dataset.colorValue||"",o.dataset.colorPath||"")}))}(a,R,(e=>{R=e,oe.checked="hex"===R,re.checked="rgb"===R,ae.checked="rgba"===R,ce.checked="hsl"===R,ie.checked="hsla"===R,le()}))}(t);else{const e=document.querySelector(".color-preview-container");e&&e.remove()}F.disabled=0===Object.keys(t).length,G.checked&&(q=function(e){const n=[],t=new Map;function o(e,n=""){if(e&&"object"==typeof e&&!Array.isArray(e))if(void 0===e.$value)for(const r in e){const a=n?`${n}/${r}`:r,c=e[r];"object"==typeof c&&null!==c?o(c,a):t.set(a,c)}else t.set(n,e.$value)}function r(e,o=""){if(e&&"object"==typeof e&&!Array.isArray(e)){if(e.$value&&"string"==typeof e.$value&&e.$value.startsWith("{")&&e.$value.endsWith("}")){const r=e.$value.substring(1,e.$value.length-1);let a=!1;for(const[e,n]of t.entries())if(e===r||e.endsWith(`/${r}`)){a=!0;break}a||n.push({path:o,reference:r,message:`Reference '${r}' not found in tokens`})}for(const a in e){const c=o?`${o}/${a}`:a,i=e[a];if("object"==typeof i&&null!==i)r(i,c);else if("string"==typeof i&&i.startsWith("{")&&i.endsWith("}")){const e=i.substring(1,i.length-1);let o=!1;for(const[n,r]of t.entries())if(n===e||n.endsWith(`/${e}`)){o=!0;break}o||n.push({path:c,reference:e,message:`Reference '${e}' not found in tokens`})}}}}for(const n in e)for(const t in e[n])o(e[n][t],`${n}/${t}`);for(const n in e)for(const t in e[n])r(e[n][t],`${n}/${t}`);return n}(t),q.length>0?(W.textContent=`Found ${q.length} reference problems. Click "Validate References" for details.`,W.className="warning"):(W.textContent="All references are valid.",W.className="success"))}document.createElement("div").id="color-preview-container",document.addEventListener("DOMContentLoaded",(()=>{if(console.log("UI loaded and initialized"),W.textContent="Extracting tokens...",W.className="info",!ee.querySelector('.tab-button[data-tab="combined"]')){const e=document.createElement("button");e.className="tab-button active",e.dataset.tab="combined",e.textContent="Combined",e.addEventListener("click",(e=>{e.preventDefault(),E("combined",ee,ne)})),ee.appendChild(e)}if(!document.getElementById("tab-combined")){const e=document.createElement("div");if(e.className="tab-content",e.id="tab-combined",e.style.display="block",U.parentNode){const n=U.cloneNode(!0);e.appendChild(n)}else e.appendChild(U);ne.appendChild(e)}_.addEventListener("change",le),K.addEventListener("change",le),G.addEventListener("change",le),X.addEventListener("change",le),Y.addEventListener("change",(()=>{le()})),oe.addEventListener("change",(()=>{oe.checked&&(R="hex",le())})),re.addEventListener("change",(()=>{re.checked&&(R="rgb",le())})),ae.addEventListener("change",(()=>{ae.checked&&(R="rgba",le())})),ce.addEventListener("change",(()=>{ce.checked&&(R="hsl",le())})),ie.addEventListener("change",(()=>{ie.checked&&(R="hsla",le())})),te.addEventListener("change",(()=>{H=te.checked,le()})),V.addEventListener("click",(()=>{const e=function(e,n,t){const o=n.querySelectorAll("input[data-collection]:not([data-mode])"),r=n.querySelectorAll("input[data-mode]");for(let n=0;n<o.length;n++)o[n].checked=e;for(let n=0;n<r.length;n++)r[n].checked=e;const a=[],c=new Map,i=Object.keys(t);return e?i.forEach((e=>{a.push(e);const n=Object.keys(t[e]);c.set(e,[...n])})):i.forEach((e=>{c.set(e,[])})),{selectedCollections:a,selectedModes:c,allCollections:i}}(!z,P,I);T=e.selectedCollections,B=e.selectedModes,O=e.allCollections,z=!z,V.textContent=z?"Deselect All":"Select All",le()})),J.addEventListener("click",(()=>{!function(e,n,t){if(0===e.length)n.innerHTML='<div class="success">All references are valid! Your tokens are ready to use with Style Dictionary.</div>';else{let t=`<div class="warning">Found ${e.length} reference problems:</div><ul>`;for(const n of e)t+=`<li class="reference-problem">\n                  Token at <strong>${n.path}</strong> \n                  references <strong>${n.reference}</strong> which cannot be resolved\n                 </li>`;t+="</ul>",t+='<div class="validation-tools">\n                <p>Recommendations:</p>\n                <ul>\n                  <li>Try using the "Flat Structure" option for easier reference resolution</li>\n                  <li>Check that all referenced tokens exist in the exported collections/modes</li>\n                  <li>Consider simplifying your token structure for better compatibility</li>\n                </ul>\n              </div>',n.innerHTML=t}t.style.display="block"}(q,Z,Q)})),D.addEventListener("click",(()=>{Q.style.display="none",U.textContent="Loading data...",W.textContent="Extracting tokens...",W.className="info",P.innerHTML='\n      <div class="loading">\n        <div class="spinner"></div>\n        Loading collections and modes...\n      </div>\n    ',F.disabled=!0,parent.postMessage({pluginMessage:{type:"extract-tokens"}},"*")})),F.addEventListener("click",(()=>{const e=[];if(B.forEach(((n,t)=>{n.forEach((n=>{e.push(n)}))})),Y.checked){const n=function(e,n,t,o){const r=$(e,n,t,o),a=[];if(o){const e=new Set;for(const n in r){const t=n.split(".");t.length>=2&&e.add(`${t[0]}.${t[1]}`)}for(const n of e){const[e,t]=n.split("."),o={};for(const e in r)e.startsWith(n)&&(o[e.substring(n.length+1)]=r[e]);Object.keys(o).length>0&&a.push({name:`${e}-${t}.json`,data:o})}}else for(const e in r)for(const n in r[e])a.push({name:`${e}-${n}.json`,data:{[e]:{[n]:r[e][n]}}});return a.push({name:"design-tokens-all.json",data:r}),a}(I,T,e,X.checked);!function(e,n,t){if(1===e.length)return void w(e[0].data,e[0].name);const o=document.createElement("div");o.style.display="none",document.body.appendChild(o);let r="<p>Multiple files are ready for download:</p><ul>";e.forEach(((e,n)=>{const t=JSON.stringify(e.data,null,2),a=new Blob([t],{type:"application/json"}),c=URL.createObjectURL(a),i=document.createElement("a");i.href=c,i.download=e.name,i.textContent=`Download ${e.name}`,i.id=`download-link-${n}`,i.className="download-link",o.appendChild(i),r+=`<li><a href="#" onclick="document.getElementById('download-link-${n}').click(); return false;">${e.name}</a></li>`})),r+="</ul>",n.innerHTML=r,t.style.display="block";const a=o.querySelector(".download-link");a&&a.click()}(n,Z,Q),W.textContent="Files ready for download. Click the links above to download each file.",W.className="success"}else w($(I,T,e,X.checked),`design-tokens-${_.checked?"dtcg":"legacy"}-${(new Date).toISOString().split("T")[0]}.json`),W.textContent="Tokens downloaded successfully!",W.className="success"}))})),window.onmessage=e=>{if(console.log("UI received message:",e.data),e.data.pluginMessage){const n=e.data.pluginMessage;if("tokens-data"===n.type){console.log("UI received tokens data"),j=JSON.parse(JSON.stringify(n.data)),I=n.data;const e=function(e,n,t){if(!e)return{selectedCollections:[],selectedModes:new Map,allCollections:[]};n.innerHTML="";const o=Object.keys(e);if(0===o.length)return n.innerHTML="<div>No collections found</div>",{selectedCollections:[],selectedModes:new Map,allCollections:[]};const r=[...o],a=new Map,c=[...o];return o.forEach((o=>{const c=document.createElement("div");c.className="collection-item",c.dataset.collection=o;const i=Object.keys(e[o]);a.set(o,[...i]);const l=document.createElement("div");l.className="collection-header";const s=document.createElement("input");s.type="checkbox",s.id=`collection-${o}`,s.checked=!0,s.dataset.collection=o;const d=document.createElement("span");d.className="collection-toggle expander-icon expanded",d.dataset.collection=o;const p=document.createElement("label");p.htmlFor=`collection-${o}`,p.textContent=o;const u=document.createElement("span");u.className="collection-badge",u.textContent=`${i.length} modes`,l.appendChild(d),l.appendChild(s),l.appendChild(p),l.appendChild(u);const f=document.createElement("div");f.className="mode-container",f.dataset.collection=o,i.forEach((n=>{const c=document.createElement("div");c.className="mode-item";const i=document.createElement("input");i.type="checkbox",i.id=`mode-${o}-${n}`,i.checked=!0,i.dataset.collection=o,i.dataset.mode=n;const l=document.createElement("label");l.htmlFor=`mode-${o}-${n}`;const d=function(e){let n=0;return function e(t){if(t&&"object"==typeof t)if(void 0===t.$value||void 0===t.$type)for(const o in t)"object"==typeof t[o]&&null!==t[o]?e(t[o]):"$type"!==o&&"$description"!==o&&n++;else n++}(e),n}(e[o][n]);l.textContent=`${n}`;const p=document.createElement("span");p.className="token-count",p.textContent=`(${d} tokens)`,l.appendChild(p),c.appendChild(i),c.appendChild(l),f.appendChild(c),i.addEventListener("change",(()=>{const e=a.get(o)||[];if(i.checked)e.includes(n)||(e.push(n),a.set(o,e));else{const t=e.filter((e=>e!==n));if(a.set(o,t),0===t.length){s.checked=!1;const e=r.indexOf(o);e>-1&&r.splice(e,1)}}t()}))})),s.addEventListener("change",(()=>{const e=f.querySelectorAll('input[type="checkbox"]');if(s.checked){r.includes(o)||r.push(o);for(let n=0;n<e.length;n++){const t=e[n];t.checked=!0;const r=t.dataset.mode;if(r){const e=a.get(o)||[];e.includes(r)||(e.push(r),a.set(o,e))}}}else{const n=r.indexOf(o);n>-1&&r.splice(n,1);for(let n=0;n<e.length;n++)e[n].checked=!1;a.set(o,[])}t()})),d.addEventListener("click",(()=>{d.classList.contains("expanded")?(d.classList.remove("expanded"),f.style.display="none"):(d.classList.add("expanded"),f.style.display="block")})),c.appendChild(l),c.appendChild(f),n.appendChild(c)})),{selectedCollections:r,selectedModes:a,allCollections:c}}(I,P,le);T=e.selectedCollections,B=e.selectedModes,O=e.allCollections,z=!0,V.textContent=z?"Deselect All":"Select All",le(),W.textContent="Tokens extracted successfully!",W.className="success"}else"error"===n.type&&(console.error("UI received error:",n.message),U.textContent="Error: "+n.message,W.textContent=n.message,W.className="error")}},console.log("UI sending ready message to plugin"),parent.postMessage({pluginMessage:{type:"ui-ready"}},"*")})();</script></body></html>